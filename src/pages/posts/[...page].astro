---
import { getCollection } from "astro:content";
import PostCard from "../../components/PostCard.astro";
import Layout from "../../layouts/Layout.astro";

// FIX: Keep this outside for use in the rendering part of the component
const POSTS_PER_PAGE = 4;

export async function getStaticPaths({ paginate }) {
  const POSTS_PER_PAGE_BUILD = 4;

  const allPosts = await getCollection("posts");

  allPosts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

  return paginate(allPosts, { pageSize: POSTS_PER_PAGE_BUILD });
}

const { page } = Astro.props;
---

<Layout>
  <section class="max-w-3xl mx-auto p-2">
    <h1>Latest Posts (Page {page.currentPage} of {page.lastPage})</h1>
    {page.data.map((post) => <PostCard post={post} />)}
  </section>

  <nav aria-label="Pagination" class="pagination-nav max-w-3xl mx-auto p-2">
    {
      page.url.prev ? (
        <a href={page.url.prev} class="prev-link">
          &larr; Newer Posts
        </a>
      ) : (
        <span class="pagination-placeholder" />
      )
    }

    <span class="pagination-separator">
      Page {page.currentPage} of {page.lastPage}
    </span>

    {
      page.url.next ? (
        <a href={page.url.next} class="next-link">
          Older Posts &rarr;
        </a>
      ) : (
        <span class="pagination-placeholder" />
      )
    }
  </nav>
</Layout>

<style>
  .pagination-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 2rem;
  }
  .pagination-placeholder {
    width: 100px;
  }
</style>
