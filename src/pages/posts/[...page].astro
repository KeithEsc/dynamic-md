---
import { getCollection } from "astro:content";
import PostCard from "../../components/PostCard.astro"; // Your component

// Keep this outside for use in the rendering part of the component
const POSTS_PER_PAGE = 6;

// 1. Define the constant INSIDE getStaticPaths for reliable scoping
export async function getStaticPaths({ paginate }) {
  // ✅ FIX: Redefine the constant locally to ensure scope (or use the one from above)
  // For maximum robustness, you can ensure it's here:
  const POSTS_PER_PAGE_BUILD = 6; // Using a different name to be explicit

  const allPosts = await getCollection("posts");

  // Sort the posts
  allPosts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

  // Use the reliable local constant for the build process
  return paginate(allPosts, { pageSize: POSTS_PER_PAGE_BUILD });
}

// 2. The rest of the component script uses the 'page' prop from paginate
const { page } = Astro.props;
---

<html lang="en">
  <head>
    <title>All Posts - Page {page.currentPage}</title>
  </head>
  <body>
    <h1>Latest Posts (Page {page.currentPage} of {page.lastPage})</h1>

    <section>
      {/* 3. Loop over the paginated data for the current page */}
      {page.data.map((post) => <PostCard post={post} />)}
    </section>

    {/* 4. Navigation using page.url helpers */}
    <nav aria-label="Pagination" class="pagination-nav">
      {/* ◀️ PREVIOUS Link (Older content) */}
      {/* Only show if a previous page exists (i.e., not on Page 1) */}
      {
        page.url.prev ? (
          <a href={page.url.prev} class="prev-link">
            &larr; Newer Posts
          </a>
        ) : (
          // Optional: Display empty space or descriptive text on Page 1
          <span class="pagination-placeholder" />
        )
      }

      <span class="pagination-separator">
        Page {page.currentPage} of {page.lastPage}
      </span>

      {/* ▶️ NEXT Link (Newer content) */}
      {/* Only show if a next page exists (i.e., not on the last page) */}
      {
        page.url.next ? (
          <a href={page.url.next} class="next-link">
            Older Posts &rarr;
          </a>
        ) : (
          // Optional: Display empty space or descriptive text on the last page
          <span class="pagination-placeholder" />
        )
      }
    </nav>
  </body>
</html>

<style>
  /* Basic example CSS to keep things aligned */
  .pagination-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 2rem;
  }
  .pagination-placeholder {
    width: 100px; /* Adjust to match link width for alignment */
  }
</style>
